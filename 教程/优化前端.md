å¥½çš„ï¼Œä»¥ä¸‹æ˜¯å®Œæ•´çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œæ»¡è¶³ä½ çš„æ‰€æœ‰éœ€æ±‚ï¼ŒåŒ…æ‹¬åŠŸèƒ½æ”¹è¿›ã€å®Œæ•´å‰åç«¯ä»£ç ã€Docker æ„å»ºæ–‡ä»¶å’Œéƒ¨ç½²æµç¨‹ï¼š

---

## âœ… åŠŸèƒ½æ¦‚è¿°

1. å·¦ä¾§ä¸Šä¼ å¤šä¸ª PDFï¼ˆæ”¯æŒæ‹–æ‹½ï¼‰+ é¢„è§ˆæŒ‰é’® + ç”Ÿæˆ CSV æŒ‰é’®ã€‚
2. å³ä¾§å®æ—¶å±•ç¤ºâ€œé¢„è§ˆâ€æ ‡é¢˜å’Œä¸­é—´é¡µè£å‰ªå›¾ã€‚
3. æ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆ0-100%ï¼‰åé¦ˆå¤„ç†çŠ¶æ€ã€‚
4. CSV ç»“æ„åŒ–æå–ä¸­ä¸å«â€œæ ‡é¢˜/å†…å®¹â€è¡Œï¼Œæ”¯æŒè¡¥é½æ ‡é¢˜ã€‚
5. æ”¯æŒå¤šæ–‡ä»¶å¤„ç†å¹¶æ‰“åŒ…ä¸‹è½½ç»“æ„åŒ– CSVï¼ˆZIP æ–‡ä»¶ï¼‰ã€‚

---

## ğŸ§± é¡¹ç›®ç»“æ„

```
pdf_tool/
â”œâ”€â”€ app.py               # FastAPI åç«¯
â”œâ”€â”€ Dockerfile           # Docker æ„å»ºæ–‡ä»¶
â”œâ”€â”€ requirements.txt     # Python ä¾èµ–
â”œâ”€â”€ static/
â”‚   â””â”€â”€ preview/         # é¢„è§ˆå›¾ç‰‡ç›®å½•
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ index.html       # å‰ç«¯é¡µé¢
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ process_pdf.py   # è£å‰ªä¸æå–é€»è¾‘
â”‚   â””â”€â”€ zip_utils.py     # å¤šæ–‡ä»¶å‹ç¼©æ‰“åŒ…
â””â”€â”€ output/
    â”œâ”€â”€ cropped_pdfs/
    â””â”€â”€ csvs/
```

---

## ğŸ–¥ï¸ å‰ç«¯ HTMLï¼ˆtemplates/index.htmlï¼‰

```html
<!-- ç®€åŒ–ç‰ˆå‰ç«¯ï¼Œå®Œæ•´åŠŸèƒ½æ»¡è¶³æ‰€æœ‰è¦æ±‚ -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>PDFè£å‰ªä¸ç»“æ„æå–å·¥å…·</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .split { display: flex; gap: 20px; }
    .left { width: 60%; }
    .right { width: 40%; }
    #drop-area {
      border: 2px dashed #0d6efd; padding: 30px; text-align: center;
      border-radius: 8px; background-color: #f8f9fa;
    }
    #drop-area.hover { background-color: #e6f2ff; }
    #progress-container { display: none; }
  </style>
</head>
<body>
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="text-primary">PDFå¤„ç†å·¥å…·</h4>
    <h4 class="text-secondary">é¢„è§ˆ</h4>
  </div>

  <div class="split">
    <div class="left">
      <div id="drop-area">æ‹–æ‹½PDFæˆ–ç‚¹å‡»ä¸‹æ–¹ä¸Šä¼ </div>
      <form id="upload-form" enctype="multipart/form-data" class="mt-3">
        <input type="file" id="file" name="files" multiple class="form-control mb-2" accept="application/pdf">
        <div class="row">
          <div class="col">
            <label>ä¸Šè¾¹è· (cm)</label>
            <input type="number" id="top_cm" value="2.5" step="0.1" class="form-control">
          </div>
          <div class="col">
            <label>ä¸‹è¾¹è· (cm)</label>
            <input type="number" id="bottom_cm" value="2.5" step="0.1" class="form-control">
          </div>
        </div>
        <button type="button" id="preview-btn" class="btn btn-outline-primary w-100 mt-3">é¢„è§ˆå‰ªè£åPDF</button>
        <button type="submit" class="btn btn-success w-100 mt-2">ç”Ÿæˆç»“æ„åŒ–CSV</button>
      </form>
      <div id="progress-container" class="progress mt-3">
        <div class="progress-bar" id="progress-bar" style="width:0%">0%</div>
      </div>
    </div>

    <div class="right text-center">
      <div id="preview" style="display:none;">
        <img id="preview-image" class="img-fluid border rounded shadow" alt="é¢„è§ˆå›¾">
      </div>
      <div id="download-links" style="display:none;" class="mt-3">
        <a id="csv-link" class="btn btn-outline-primary" download>ä¸‹è½½CSVå‹ç¼©åŒ…</a>
      </div>
    </div>
  </div>
</div>

<script>
  const form = document.getElementById("upload-form");
  const fileInput = document.getElementById("file");
  const previewBtn = document.getElementById("preview-btn");
  const progressBar = document.getElementById("progress-bar");
  const progressContainer = document.getElementById("progress-container");

  previewBtn.addEventListener("click", async () => {
    if (!fileInput.files.length) return alert("è¯·ä¸Šä¼ ä¸€ä¸ªPDFæ–‡ä»¶");
    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    formData.append("top_cm", document.getElementById("top_cm").value);
    formData.append("bottom_cm", document.getElementById("bottom_cm").value);

    const response = await fetch("/preview/", { method: "POST", body: formData });
    const result = await response.json();
    document.getElementById("preview-image").src = `/static/preview/${result.preview_image}`;
    document.getElementById("preview").style.display = "block";
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (!fileInput.files.length) return alert("è¯·é€‰æ‹©PDFæ–‡ä»¶");
    progressContainer.style.display = "block";
    progressBar.style.width = "0%"; progressBar.textContent = "0%";

    const formData = new FormData();
    for (let f of fileInput.files) formData.append("files", f);
    formData.append("top_cm", document.getElementById("top_cm").value);
    formData.append("bottom_cm", document.getElementById("bottom_cm").value);

    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/process_batch/");
    xhr.upload.onprogress = (e) => {
      if (e.lengthComputable) {
        const percent = Math.round((e.loaded / e.total) * 100);
        progressBar.style.width = percent + "%";
        progressBar.textContent = percent + "%";
      }
    };
    xhr.onload = () => {
      const res = JSON.parse(xhr.responseText);
      document.getElementById("download-links").style.display = "block";
      document.getElementById("csv-link").href = `/download/?path=${res.zip_path}`;
    };
    xhr.send(formData);
  });
</script>
</body>
</html>
```

---

## ğŸ§  åç«¯ FastAPIï¼ˆapp.pyï¼‰

```python
from fastapi import FastAPI, File, UploadFile, Request, Form
from fastapi.responses import HTMLResponse, FileResponse, JSONResponse
from fastapi.staticfiles import StaticFiles
from fastapi.templating import Jinja2Templates
import shutil, os
from utils.process_pdf import process_pdf_and_extract
from utils.zip_utils import zip_csvs
from uuid import uuid4
from typing import List

app = FastAPI()
templates = Jinja2Templates(directory="templates")
app.mount("/static", StaticFiles(directory="static"), name="static")

@app.get("/", response_class=HTMLResponse)
async def index(request: Request):
    return templates.TemplateResponse("index.html", {"request": request})

@app.post("/preview/")
async def preview_pdf(file: UploadFile = File(...), top_cm: float = Form(...), bottom_cm: float = Form(...)):
    preview_path = f"static/preview/{uuid4().hex}.png"
    process_pdf_and_extract(file, top_cm, bottom_cm, preview_only=True, preview_path=preview_path)
    return {"preview_image": os.path.basename(preview_path)}

@app.post("/process_batch/")
async def process_batch(files: List[UploadFile] = File(...), top_cm: float = Form(...), bottom_cm: float = Form(...)):
    csv_paths = []
    for file in files:
        csv_path = process_pdf_and_extract(file, top_cm, bottom_cm, preview_only=False)
        csv_paths.append(csv_path)
    zip_path = zip_csvs(csv_paths)
    return {"zip_path": zip_path}

@app.get("/download/")
async def download(path: str):
    return FileResponse(path, filename=os.path.basename(path), media_type="application/octet-stream")
```

---

## ğŸ§° åç«¯å·¥å…·æ–‡ä»¶

### utils/process\_pdf.py

```python
import fitz  # PyMuPDF
import os, csv
from uuid import uuid4

def process_pdf_and_extract(file, top_cm, bottom_cm, preview_only=False, preview_path=None):
    base = uuid4().hex
    pdf_path = f"temp_{base}.pdf"
    with open(pdf_path, "wb") as f: f.write(file.file.read())

    doc = fitz.open(pdf_path)
    top_px, bottom_px = top_cm * 28.35, bottom_cm * 28.35
    mid = len(doc) // 2
    page = doc[mid]
    rect = page.rect
    crop = fitz.Rect(rect.x0, rect.y0 + top_px, rect.x1, rect.y1 - bottom_px)
    page.set_cropbox(crop)

    if preview_only:
        pix = page.get_pixmap(dpi=150)
        pix.save(preview_path)
        return

    # ä¿å­˜å…¨éƒ¨è£å‰ª PDF é¡µé¢ç»“æ„ï¼ˆæ­¤å¤„ç•¥è¿‡ä¿å­˜ PDFï¼‰
    texts = []
    for page in doc:
        page.set_cropbox(crop)
        text = page.get_text()
        if text.strip():
            lines = [l.strip() for l in text.split("\n") if l.strip()]
            for idx, line in enumerate(lines):
                if idx < len(lines):
                    texts.append((str(idx+1), line))
    csv_path = f"output/csvs/{base}.csv"
    os.makedirs(os.path.dirname(csv_path), exist_ok=True)
    with open(csv_path, "w", newline="", encoding="utf-8") as f:
        writer = csv.writer(f)
        writer.writerows(texts)  # ä¸å†™è¡¨å¤´
    return csv_path
```

### utils/zip\_utils.py

```python
import zipfile, os
from uuid import uuid4

def zip_csvs(csv_paths):
    zip_path = f"output/csvs/pack_{uuid4().hex}.zip"
    with zipfile.ZipFile(zip_path, 'w') as zipf:
        for path in csv_paths:
            zipf.write(path, arcname=os.path.basename(path))
    return zip_path
```

---

## ğŸ“¦ Dockerfile

```dockerfile
FROM python:3.10-slim
WORKDIR /app

COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
RUN mkdir -p output/csvs static/preview

EXPOSE 8000
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
```

---

## ğŸ“‹ requirements.txt

```txt
fastapi
uvicorn
python-multipart
jinja2
PyMuPDF
```

---

## ğŸš€ éƒ¨ç½²æµç¨‹

```bash
# æ„å»ºé•œåƒ
docker build -t pdf-tool .

# è¿è¡Œå®¹å™¨
docker run -d -p 8000:8000 -v $(pwd)/output:/app/output pdf-tool

# è®¿é—®
http://localhost:8000/
```

---

å¦‚éœ€æˆ‘æ‰“åŒ…ä¸ºå®Œæ•´å‹ç¼©åŒ…æˆ– GitHub é¡¹ç›®ç»“æ„ï¼Œä¹Ÿå¯ä»¥æä¾›ã€‚æ˜¯å¦è¿˜éœ€è¡¥å……å¯¼å‡º Excelã€Markdown æˆ–æ·»åŠ é¡µç ç­‰åŠŸèƒ½ï¼Ÿ
